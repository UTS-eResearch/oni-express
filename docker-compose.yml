version: '3.1'

networks:
  main:

services:
  oni-express:
    environment:
      - NODE_ENV=development
    build: .
    ports:
      - "8080:8080"
    expose:
      - "8080"
    networks:
      - main
    volumes:
      - "/repo/ocfl/grants_ocfl:/etc/share/ocfl"
      - "./config:/etc/share/config"

  # Oni-Indexer currently using a build branch matching oni-express
  # place it under ../oni-indexer
  oni-indexer:
    build: ../oni-indexer
    ports:
      - "8090:8090"
    expose:
      - "8090"
    networks:
      - main
    volumes:
      - "/repo/ocfl/grants_ocfl:/etc/share/ocfl"
      - "./config/:/etc/share/config"
      - "./logs/:/etc/share/logs"

  solr:
    image: solr:8.6.3
    ports:
      - "8983:8983"
    expose:
      - "8983"
    networks:
      - main
    volumes:
      - "/solrcore/solrdata/data:/var/solr/data"
      - "/solrcore/solrdata/log4j2.xml:/var/solr/log4j2.xml"
    environment:
      - LOG4J_FORMAT_MSG_NO_LOOKUPS=true
      - SOLR_HEAP=1G
    command: solr-precreate ocfl
    logging:
      driver: "json-file"

  memcached:
    image: memcached
    ports:
      - "11211:11211"
    expose:
      - "11211"
    networks:
      - main
